<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat 5B</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://kit.fontawesome.com/46a5e4490b.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>

  <!-- NAVBAR -->
  <nav class="navbar">
    <a class="navbar-brand mx-auto text-white" href="/">
    Software
    </a>
  </nav>

  <form class="reformg">
    <div class="mb-3">
      <label for="exampleInputEmail1" class="form-label">Nombre</label>
      <input type="email" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp">
      <div id="emailHelp" class="form-text">Tu nobre es propio y solo tuyo.</div>
    </div>
  
    <button type="submit" class="btn btn-primary">Enviar</button>
  </form>

  <!-- CHAT CONTAINER -->
  <div class="row p-5 h-100" id="contentWrap">
    <div class="col-md-8">
      <div class="card bg-dark text-white rounded-0">
        <!-- CARD HEADER-->
        <div class="card-header text-white">
          <h4>Chat de 5B</h4>
        </div>

        <!-- CARD BODY-->
        <div id="chat" class="card-body chat"></div>

        <!-- CARD FOOTER -->
        <form id="message-form" class="card-footer">
          <div class="input-group">
            <input type="text" id="message" class="form-control" placeholder="Escribe un mensaje..." />
            <button type="button" class="btn rounded-0" onclick="sendMessage()">
              <i class="fas fa-location-arrow"></i>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- SCRIPT -->
  <script>
    const chatDiv = document.getElementById('chat');
    const messageInput = document.getElementById('message');
    const messageForm = document.getElementById('message-form');

    const ws = new WebSocket('ws://192.168.1.165:3000');

    ws.onmessage = function (event) {
      const message = event.data;
      appendMessage(message);
    };

    messageForm.addEventListener('submit', function (event) {
      event.preventDefault();
      sendMessage();
    });

    function sendMessage() {
      const message = messageInput.value;
      if (message) {
        const currentTime = new Date().toLocaleString();
        const messageWithTimestamp = `${currentTime}: ${message}`;
        ws.send(messageWithTimestamp);
        messageInput.value = '';
        scrollToBottom();
      }
    }

    function appendMessage(message) {
      const messageElement = document.createElement('div');
      messageElement.textContent = message;
      chatDiv.appendChild(messageElement);
      scrollToBottom();
    }

    function scrollToBottom() {
      chatDiv.scrollTop = chatDiv.scrollHeight;
      // scroll to bottom of messages
      message.scrollTop = message.scrollHeight;
      
    }
  </script>



  
</body>

</html>